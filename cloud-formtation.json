{
  "AWSTemplateFormatVersion" : "2010-09-09",
 
  "Description" : "AWS CloudFormation Sample Template DynamoDB_Table: This template demonstrates the creation of a DynamoDB table.  **WARNING** This template creates an Amazon DynamoDB table. You will be billed for the AWS resources used if you create a stack from this template.",
 
  "Parameters" : {
    "ProjectName" : {
      "Description" : "HashType PrimaryKey Name",
      "Type" : "String",
      "AllowedPattern" : "[a-zA-Z0-9]*",
      "MinLength": "1",
      "MaxLength": "2048",
      "ConstraintDescription" : "must contain only alphanumberic characters"
    },
    "Env" : {
      "Description" : "HashType PrimaryKey Type",
      "Type" : "String",
      "Default" : "S",
      "AllowedPattern" : "[S|N]",
      "MinLength": "1",
      "MaxLength": "1",
      "ConstraintDescription" : "must be either S or N"
    }
  },
  "Resources" : {
    "acpsubscriptionuserbtable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": [
          {
            "Fn::Join": [
              "-",
              [
                {
                  "Ref": "ProjectName"
                },
                {
                  "Ref": "Env"
                }
              ]
            ]
          }
        ],
        "AttributeDefinitions": [
          {
            "AttributeName": "userSub",
            "AttributeType": "S"
          },
          {
            "AttributeName": "metadataType",
            "AttributeType": "S"
          },
          {
            "AttributeName": "chargebeeId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "TYPE",
            "AttributeType": "S"
          },
          {
            "AttributeName": "typeIndexRangeKey",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "userSub",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "metadataType",
            "KeyType": "RANGE"
          }
        ],
        "LocalSecondaryIndexes": [
          {
            "IndexName": "chargebeeid",
            "KeySchema": [
              {
                "AttributeName": "userSub",
                "KeyType": "HASH"
              },
              {
                "AttributeName": "chargebeeId",
                "KeyType": "RANGE"
              }
            ],
            "Projection": {
              "ProjectionType": "KEYS_ONLY"
            }
          }
        ],
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "recordtypeglobalindex",
            "KeySchema": [
              {
                "AttributeName": "TYPE",
                "KeyType": "HASH"
              },
              {
                "AttributeName": "typeIndexRangeKey",
                "KeyType": "RANGE"
              }
            ],
            "Projection": {
              "ProjectionType": "KEYS_ONLY"
            }
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "TimeToLiveSpecification": {
          "AttributeName": "timeToLive",
          "Enabled": true
        }
      }
    }
  },
  "Outputs" : {
    "TableName" : {
      "Value" : {"Ref" : "acpsubscriptionuserbtable"},
      "Description" : "Table name of the newly created DynamoDB table"
    }
  }
}

